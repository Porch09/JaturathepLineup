<<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Jaturathep</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#74ebd5,#acb6e5);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:0;
  padding:10px;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:linear-gradient(to bottom,rgba(0,0,0,.45),rgba(0,0,0,.2),rgba(0,0,0,.45));
  z-index:0;
}
.container{
  position:relative;
  z-index:1;
  background:#fff;
  padding:20px;
  border-radius:15px;
  width:100%;
  max-width:780px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}
h1{text-align:center;font-size:1.8em}
.top-bar{display:flex;justify-content:space-between;flex-wrap:wrap;margin-bottom:15px}
button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:.85em
}
.edit-btn{background:#fc6464;color:#fff}
.reset-btn{background:#e63946;color:#fff}
.add-btn{background:#2a9d8f;color:#fff}
.sub-btn{background:#6c757d;color:#fff}
.delete-btn{background:#000;color:#fff}
table{width:100%;border-collapse:collapse}
th,td{
  padding:6px;
  text-align:center;
  border-bottom:1px solid #ddd;
  font-size:.85em
}
th{background:#f1f1f1}
.edit-area{
  margin-top:10px;
  display:none;
  gap:5px;
  flex-wrap:wrap
}
input{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
  flex:1
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10
}
.modal-content{
  background:#fff;
  padding:20px;
  border-radius:12px;
  width:100%;
  max-width:300px;
  text-align:center
}
.error{color:red;font-size:.85em}
</style>
</head>

<body>
<div class="container">
  <h1>Jaturathep</h1>

  <div class="top-bar">
    <div id="counter">สมาชิก 0 / 30</div>
    <button class="edit-btn" id="editModeBtn">Tools</button>
    <button class="reset-btn" id="resetBtn" style="display:none">รีเซ็ต</button>
  </div>

  <table>
    <thead id="thead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="edit-area" id="editArea">
    <input id="nameInput" placeholder="กรอกชื่อ">
    <button class="add-btn" id="addBtn">เพิ่ม</button>
    <button class="add-btn" style="background:#457b9d" id="saveBtn">บันทึก</button>
  </div>
</div>

<!-- PASSWORD MODAL -->
<div class="modal" id="passwordModal">
  <div class="modal-content">
    <h3>ใส่รหัสผ่าน</h3>
    <input type="password" id="passwordInput">
    <div class="error" id="errorMsg"></div>
    <button class="add-btn" id="confirmBtn">ยืนยัน</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

/* Firebase */
const firebaseConfig={
  apiKey:"AIzaSyDsM9ByXHwfxhAG8lBfRKiHSGuxwSiAdls",
  authDomain:"jaturathep-55793.firebaseapp.com",
  databaseURL:"https://jaturathep-55793-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"jaturathep-55793",
  storageBucket:"jaturathep-55793.firebasestorage.app",
  messagingSenderId:"681766321980",
  appId:"1:681766321980:web:cea8b2eee2e3196f10e839"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRef = ref(db,"jaturathep");

/* CONFIG */
const PASSWORD="jtrt99";
const maxMembers=30;

/* STATE */
let members=[];
let editMode=false;

/* ELEMENTS */
const counter=document.getElementById("counter");
const tableBody=document.getElementById("tableBody");
const thead=document.getElementById("thead");
const editArea=document.getElementById("editArea");
const resetBtn=document.getElementById("resetBtn");
const editModeBtn=document.getElementById("editModeBtn");
const nameInput=document.getElementById("nameInput");

const passwordModal=document.getElementById("passwordModal");
const passwordInput=document.getElementById("passwordInput");
const errorMsg=document.getElementById("errorMsg");
const confirmBtn=document.getElementById("confirmBtn");
const addBtn=document.getElementById("addBtn");
const saveBtn=document.getElementById("saveBtn");

/* REALTIME */
onValue(dbRef,snap=>{
  members=snap.val()||[];
  render();
});

/* RENDER */
function render(){
  tableBody.innerHTML="";

  if(editMode){
    thead.innerHTML=`
      <tr>
        <th>ชื่อ</th>
        <th>แทโอ</th>
        <th>ไคล์</th>
        <th>ยอนฮี</th>
        <th>คาร์ม่า</th>
        <th>ลบ</th>
      </tr>`;
    members.forEach((m,i)=>{
      m.tao ??= 0;
      m.kyle ??= 0;
      m.yeonhee ??= 0;
      m.karma ??= 0;
      tableBody.innerHTML+=`
      <tr>
        <td>${m.name}</td>
        ${["tao","kyle","yeonhee","karma"].map(k=>`
          <td>
            <button class="sub-btn" onclick="chg(${i},'${k}',-1)">−</button>
            ${m[k]}
            <button class="add-btn" onclick="chg(${i},'${k}',1)">+</button>
          </td>
        `).join("")}
        <td>
          <button class="delete-btn" onclick="delMember(${i})">ลบ</button>
        </td>
      </tr>`;
    });
  }else{
    thead.innerHTML=`
      <tr>
        <th>ชื่อ</th>
        <th>จำนวน</th>
      </tr>`;
    members.forEach(m=>{
      const sum=(m.tao||0)+(m.kyle||0)+(m.yeonhee||0)+(m.karma||0);
      tableBody.innerHTML+=`
        <tr>
          <td>${m.name}</td>
          <td>${sum}</td>
        </tr>`;
    });
  }

  counter.innerText=`สมาชิก ${members.length} / ${maxMembers}`;
}

/* ACTIONS */
window.chg=(i,k,v)=>{
  members[i][k]=Math.max(0,(members[i][k]||0)+v);
  save();
};
window.delMember=i=>{
  if(confirm("ลบรายชื่อนี้?")){
    members.splice(i,1);
    save();
  }
};
function save(){ set(dbRef,members); }

/* EVENTS */
editModeBtn.onclick=()=>passwordModal.style.display="flex";

confirmBtn.onclick=()=>{
  if(passwordInput.value===PASSWORD){
    editMode=true;
    passwordModal.style.display="none";
    passwordInput.value="";
    errorMsg.innerText="";
    editArea.style.display="flex";
    resetBtn.style.display="inline-block";
    editModeBtn.style.display="none";
    render();
  }else{
    errorMsg.innerText="รหัสผ่านไม่ถูกต้อง";
  }
};

addBtn.onclick=()=>{
  const n=nameInput.value.trim();
  if(!n||members.length>=maxMembers)return;
  members.push({name:n,tao:0,kyle:0,yeonhee:0,karma:0});
  nameInput.value="";
  save();
};

saveBtn.onclick=()=>{
  editMode=false;
  editArea.style.display="none";
  resetBtn.style.display="none";
  editModeBtn.style.display="inline-block";
  render();
};

resetBtn.onclick=()=>{
  if(confirm("รีเซ็ตทั้งหมด?")){
    members.forEach(m=>{
      m.tao=0;m.kyle=0;m.yeonhee=0;m.karma=0;
    });
    save();
  }
};
</script>
</body>
</html>
