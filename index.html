<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Jaturathep</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== BASE ===== */
html,body{
  width:100%;
  height:100%;
}

body{
  font-family:'Segoe UI',sans-serif;
  background-image:url('https://images.alphacoders.com/873/873497.jpg');
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  min-height:100vh;
  margin:0;
  padding:15px;
  overflow-y:auto;              /* ‚úÖ ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
}

/* overlay */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.12);
  z-index:0;
}

/* container ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ó‡∏ô body */
.container{
  position:relative;
  z-index:1;
  background:#fff;
  padding:20px;
  border-radius:15px;
  width:100%;
  max-width:780px;
  margin:0 auto;                /* ‚úÖ ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}

h1{text-align:center;font-size:1.8em;margin:5px 0 15px}

.top-bar{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:15px;
}

button{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:.85em
}

.edit-btn{background:#fc6464;color:#fff}
.reset-btn{background:#e63946;color:#fff}
.add-btn{background:#2a9d8f;color:#fff}
.sub-btn{background:#6c757d;color:#fff}
.delete-btn{background:#000;color:#fff}

table{width:100%;border-collapse:collapse}
th,td{
  padding:6px;
  text-align:center;
  border-bottom:1px solid #ddd;
  font-size:.85em
}
th{background:#f1f1f1}

.edit-area{
  margin-top:10px;
  display:none;
  gap:5px;
  flex-wrap:wrap
}

input{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
  flex:1
}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10
}

.modal-content{
  background:#fff;
  padding:20px;
  border-radius:12px;
  width:100%;
  max-width:300px;
  text-align:center
}

.error{color:red;font-size:.85em}

/* ===== DARK MODE ===== */
body.dark::before{
  background:rgba(0,0,0,.45);
}

body.dark .container{
  background:rgba(20,20,20,.92);
  color:#eee;
}

body.dark th{background:#2a2a2a;color:#fff}
body.dark td{border-bottom:1px solid #444}
body.dark input{
  background:#222;
  color:#fff;
  border:1px solid #555;
}

/* ===== MOBILE FIX ===== */
@media (max-width:768px){
  body{
    background-position:center top;
    padding:10px;
  }
}
</style>
</head>

<body>
<div class="container">
  <h1>Jaturathep</h1>

  <div class="top-bar">
    <div id="counter">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 0 / 30</div>
    <div>
      <button class="sub-btn" id="darkModeBtn">üåô Dark</button>
      <button class="edit-btn" id="editModeBtn">Tools</button>
      <button class="reset-btn" id="resetBtn" style="display:none">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </div>
  </div>

  <table>
    <thead id="thead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="edit-area" id="editArea">
    <input id="nameInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
    <button class="add-btn" id="addBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
    <button class="add-btn" style="background:#457b9d" id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
</div>

<!-- PASSWORD MODAL -->
<div class="modal" id="passwordModal">
  <div class="modal-content">
    <h3>‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
    <input type="password" id="passwordInput">
    <div class="error" id="errorMsg"></div>
    <button class="add-btn" id="confirmBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyDsM9ByXHwfxhAG8lBfRKiHSGuxwSiAdls",
  authDomain:"jaturathep-55793.firebaseapp.com",
  databaseURL:"https://jaturathep-55793-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"jaturathep-55793",
  storageBucket:"jaturathep-55793.firebasestorage.app",
  messagingSenderId:"681766321980",
  appId:"1:681766321980:web:cea8b2eee2e3196f10e839"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dbRef=ref(db,"jaturathep");

const PASSWORD="jtrt99";
const maxMembers=30;
let members=[],editMode=false;

const counter=document.getElementById("counter");
const tableBody=document.getElementById("tableBody");
const thead=document.getElementById("thead");
const editArea=document.getElementById("editArea");
const resetBtn=document.getElementById("resetBtn");
const editModeBtn=document.getElementById("editModeBtn");
const nameInput=document.getElementById("nameInput");

const passwordModal=document.getElementById("passwordModal");
const passwordInput=document.getElementById("passwordInput");
const errorMsg=document.getElementById("errorMsg");

onValue(dbRef,snap=>{
  members=snap.val()||[];
  render();
});

function render(){
  tableBody.innerHTML="";
  if(editMode){
    thead.innerHTML=`<tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÅ‡∏ó‡πÇ‡∏≠</th><th>‡πÑ‡∏Ñ‡∏•‡πå</th><th>‡∏¢‡∏≠‡∏ô‡∏Æ‡∏µ</th><th>‡∏Ñ‡∏≤‡∏£‡πå‡∏°‡πà‡∏≤</th><th>‡∏•‡∏ö</th></tr>`;
    members.forEach((m,i)=>{
      m.tao??=0;m.kyle??=0;m.yeonhee??=0;m.karma??=0;
      tableBody.innerHTML+=`
      <tr>
        <td>${m.name}</td>
        ${["tao","kyle","yeonhee","karma"].map(k=>`
        <td>
          <button class="sub-btn" onclick="chg(${i},'${k}',-1)">‚àí</button>
          ${m[k]}
          <button class="add-btn" onclick="chg(${i},'${k}',1)">+</button>
        </td>`).join("")}
        <td><button class="delete-btn" onclick="delMember(${i})">‡∏•‡∏ö</button></td>
      </tr>`;
    });
  }else{
    thead.innerHTML=`<tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th></tr>`;
    members.forEach(m=>{
      const sum=(m.tao||0)+(m.kyle||0)+(m.yeonhee||0)+(m.karma||0);
      tableBody.innerHTML+=`<tr><td>${m.name}</td><td>${sum}</td></tr>`;
    });
  }
  counter.innerText=`‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ${members.length} / ${maxMembers}`;
}

window.chg=(i,k,v)=>{members[i][k]=Math.max(0,(members[i][k]||0)+v);set(dbRef,members);}
window.delMember=i=>{if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ?")){members.splice(i,1);set(dbRef,members);}}

/* DARK MODE */
const darkBtn=document.getElementById("darkModeBtn");
if(localStorage.getItem("dark")==="1"){
  document.body.classList.add("dark");
  darkBtn.innerText="‚òÄÔ∏è Light";
}
darkBtn.onclick=()=>{
  document.body.classList.toggle("dark");
  const d=document.body.classList.contains("dark");
  darkBtn.innerText=d?"‚òÄÔ∏è Light":"üåô Dark";
  localStorage.setItem("dark",d?"1":"0");
};
</script>
</body>
</html>
