<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Jaturathep Lineup</title>

<!-- ใช้ Firebase แบบ Module อย่างเดียว (แก้ Script error จาก version mismatch) -->

<style>
:root{
  --bg1:#667eea;
  --bg2:#764ba2;
  --card:rgba(255,255,255,.15);
  --border:rgba(255,255,255,.3);
  --text:#fff;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;font-family:"Segoe UI",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;align-items:center;justify-content:center;color:var(--text);
}
.app{width:100%;max-width:720px;padding:20px;}
.card{
  background:var(--card);backdrop-filter:blur(14px);
  border:1px solid var(--border);border-radius:18px;padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
h1{margin:0;font-size:26px;letter-spacing:1px;}
.badge{font-size:14px;opacity:.85;}
.controls{display:flex;gap:10px;margin-bottom:14px;flex-wrap:wrap;}
button{border:none;padding:10px 16px;border-radius:12px;cursor:pointer;font-size:14px;transition:.2s;}
button.primary{background:#22c55e;color:#064e3b;}
button.danger{background:#ef4444;color:#fff;}
button.ghost{background:rgba(255,255,255,.2);color:#fff;}
button:hover{transform:translateY(-1px);filter:brightness(1.1);}
input{flex:1;padding:10px 14px;border-radius:12px;border:none;outline:none;font-size:14px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:12px;text-align:center;}
th{opacity:.85;border-bottom:1px solid var(--border);} 
tr:not(:last-child) td{border-bottom:1px solid rgba(255,255,255,.15);} 
.actions button{padding:6px 10px;font-size:13px;} 
.footer{margin-top:12px;text-align:center;font-size:13px;opacity:.8;}
</style>
</head>

<body>
<div class="app">
  <div class="card">
    <header>
      <h1>Jaturathep</h1>
      <div class="badge">สมาชิก <span id="count">0</span> / 30</div>
    </header>

    <div class="controls">
      <input id="nameInput" placeholder="เพิ่มชื่อสมาชิก..." />
      <button class="primary" onclick="addMember()">เพิ่ม</button>
      <button class="danger" onclick="resetAll()">รีเซ็ต</button>
    </div>

    <table>
      <thead>
        <tr><th>ชื่อ</th><th>จำนวน</th><th>จัดการ</th></tr>
      </thead>
      <tbody id="list"></tbody>
    </table>

    <div class="footer">
      Realtime Lineup • Viewer / Owner Mode
    </div>
  </div>
</div>

<script type="module">
  /* ================= Firebase v12 (Module) ================= */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, onValue, get, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDsM9ByXHwfxhAG8lBfRKiHSGuxwSiAdls",
    authDomain: "jaturathep-55793.firebaseapp.com",
    databaseURL: "https://jaturathep-55793-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "jaturathep-55793",
    storageBucket: "jaturathep-55793.firebasestorage.app",
    messagingSenderId: "681766321980",
    appId: "1:681766321980:web:cea8b2eee2e3196f10e839"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const dbRef = ref(db, "jaturathep");

  /* ================= App Logic ================= */
  const maxMembers = 30;
  const isOwner = location.hash === "#admin";

  const list = document.getElementById("list");
  const countEl = document.getElementById("count");
  const nameInput = document.getElementById("nameInput");

  function render(members = []){
    list.innerHTML = "";
    members.forEach((m,i)=>{
      list.innerHTML += `
        <tr>
          <td>${m.name}</td>
          <td>${m.count}</td>
          <td class="actions">
            ${isOwner ? `
              <button class="ghost add" data-i="${i}">+</button>
              <button class="ghost del" data-i="${i}">ลบ</button>
            ` : "ดูอย่างเดียว"}
          </td>
        </tr>`;
    });
    countEl.innerText = members.length;

    if(isOwner){
      document.querySelectorAll('.add').forEach(b=>{
        b.onclick = ()=>addCount(Number(b.dataset.i));
      });
      document.querySelectorAll('.del').forEach(b=>{
        b.onclick = ()=>removeMember(Number(b.dataset.i));
      });
    }
  }

  onValue(dbRef, snap => {
    render(snap.val() || []);
  });

  window.addMember = async function(){
    if(!isOwner) return alert("โหมดดูอย่างเดียว");
    const name = nameInput.value.trim();
    if(!name) return;

    const snap = await get(dbRef);
    const data = snap.val() || [];
    if(data.length >= maxMembers) return alert("ครบ 30 คนแล้ว");

    data.push({name, count:0});
    await set(dbRef, data);
    nameInput.value = "";
  }

  async function addCount(i){
    const snap = await get(dbRef);
    const data = snap.val();
    if(!data || !data[i]) return;
    data[i].count++;
    await set(dbRef, data);
  }

  async function removeMember(i){
    const snap = await get(dbRef);
    const data = snap.val();
    if(!data) return;
    data.splice(i,1);
    await set(dbRef, data);
  }

  window.resetAll = async function(){
    if(!isOwner) return;
    if(!confirm("รีเซ็ตทั้งหมด?")) return;
    const snap = await get(dbRef);
    const data = snap.val() || [];
    data.forEach(m=>m.count=0);
    await set(dbRef, data);
  }
</script>
</body>
</html>
