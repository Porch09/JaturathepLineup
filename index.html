<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Jaturathep</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#74ebd5,#acb6e5);min-height:100vh;display:flex;justify-content:center;align-items:center;margin:0;padding:10px}
.container{background:#fff;padding:20px;border-radius:15px;width:100%;max-width:720px;box-shadow:0 10px 25px rgba(0,0,0,.15)}
h1{text-align:center;font-size:1.8em}
.top-bar{display:flex;flex-wrap:wrap;justify-content:space-between;margin-bottom:15px}
button{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-size:.9em}
.edit-btn{background:#ffb703}.reset-btn{background:#e63946;color:#fff}
.add-btn{background:#2a9d8f;color:#fff}.delete-btn{background:#e63946;color:#fff}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;text-align:center;border-bottom:1px solid #ddd}
th{background:#f1f1f1}
.edit-area{margin-top:10px;display:none;gap:5px;flex-wrap:wrap}
input{padding:8px;border-radius:6px;border:1px solid #ccc;flex:1}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:100%;max-width:300px;text-align:center}
.error{color:red;font-size:.85em}
</style>
</head>
<body>
<div class="container">
<h1>Jaturathep</h1>
<div class="top-bar">
<div id="counter">สมาชิก 0 / 30</div>
<button class="edit-btn" id="editModeBtn">เข้าสู่โหมดแก้ไข</button>
<button class="reset-btn" id="resetBtn" style="display:none">รีเซ็ตจำนวนไม้</button>
</div>
<table>
<thead><tr><th>ชื่อ</th><th>จำนวนไม้</th><th>จัดการ</th></tr></thead>
<tbody id="tableBody"></tbody>
</table>
<div class="edit-area" id="editArea">
<input id="nameInput" placeholder="กรอกชื่อ">
<button class="add-btn" id="addBtn">เพิ่มรายชื่อ</button>
<button class="add-btn" style="background:#457b9d" id="saveBtn">บันทึก</button>
</div>
</div>

<div class="modal" id="passwordModal">
<div class="modal-content">
<h3>ใส่รหัสผ่าน</h3>
<input type="password" id="passwordInput">
<div class="error" id="errorMsg"></div>
<button class="add-btn" id="confirmBtn">ยืนยัน</button>
</div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig={apiKey:"AIzaSyDsM9ByXHwfxhAG8lBfRKiHSGuxwSiAdls",authDomain:"jaturathep-55793.firebaseapp.com",databaseURL:"https://jaturathep-55793-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"jaturathep-55793",storageBucket:"jaturathep-55793.firebasestorage.app",messagingSenderId:"681766321980",appId:"1:681766321980:web:cea8b2eee2e3196f10e839"};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const dbRef=ref(db,"jaturathep");

const PASSWORD="jtrt99";
const maxMembers=30;
let members=[];
let editMode=sessionStorage.getItem("editMode")==="true";

const counter=document.getElementById("counter");
const tableBody=document.getElementById("tableBody");
const editArea=document.getElementById("editArea");
const resetBtn=document.getElementById("resetBtn");
const editModeBtn=document.getElementById("editModeBtn");
const nameInput=document.getElementById("nameInput");

onValue(dbRef,snap=>{members=snap.val()||[];render();});

function render(){tableBody.innerHTML="";members.forEach((m,i)=>{tableBody.innerHTML+=`<tr><td>${m.name}</td><td>${m.count}</td><td>${editMode?`<button class='add-btn' data-i='${i}'>+</button><button class='delete-btn' data-i='${i}'>ลบ</button>`:"-"}</td></tr>`});counter.innerText=`สมาชิก ${members.length} / ${maxMembers}`;if(editMode){document.querySelectorAll(".add-btn[data-i]").forEach(b=>b.onclick=()=>{members[b.dataset.i].count++;save()});document.querySelectorAll(".delete-btn").forEach(b=>b.onclick=()=>{members.splice(b.dataset.i,1);save()})}}

function save(){set(dbRef,members)}

function updateUI(){editArea.style.display=editMode?"flex":"none";resetBtn.style.display=editMode?"inline-block":"none";editModeBtn.style.display=editMode?"none":"inline-block";render()}

editModeBtn.onclick=()=>passwordModal.style.display="flex";
document.getElementById("confirmBtn").onclick=()=>{if(passwordInput.value===PASSWORD){editMode=true;sessionStorage.setItem("editMode","true");passwordModal.style.display="none";updateUI()}else errorMsg.innerText="รหัสผ่านไม่ถูกต้อง"};

document.getElementById("addBtn").onclick=()=>{const name=nameInput.value.trim();if(!name||members.length>=maxMembers)return;members.push({name,count:0});nameInput.value="";save()};

document.getElementById("saveBtn").onclick=()=>{editMode=false;sessionStorage.removeItem("editMode");updateUI()};

resetBtn.onclick=()=>{if(confirm("รีเซ็ตทั้งหมด?")){members.forEach(m=>m.count=0);save()}};

updateUI();
</script>
</body>
</html>
