<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Jaturathep</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== RESET ===== */
html,body{
  width:100%;
  min-height:100%;
  margin:0;
}

/* ===== BODY ===== */
body{
  font-family:'Segoe UI',sans-serif;
  background-image:url('https://cdnb.artstation.com/p/assets/images/images/018/331/071/large/ryunkyung-oh-1.jpg?1558985328');
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  padding:15px;
}

/* ===== OVERLAY ===== */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.05);
  z-index:0;
  pointer-events:none;
}

/* ===== CENTER ===== */
.center{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* ===== LANDING ===== */
.landing{
  position:relative;
  z-index:1;
  background:#fff;
  padding:30px;
  border-radius:18px;
  width:100%;
  max-width:380px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
}

.select-btn{
  width:100%;
  padding:18px;
  font-size:1.3em;
  border:none;
  border-radius:14px;
  cursor:pointer;
  background:#2a9d8f;
  color:#fff;
}

/* ===== CONTAINER ===== */
.container{
  display:none;
  position:relative;
  z-index:1;
  background:#fff;
  padding:15px;
  border-radius:15px;
  width:100%;
  max-width:780px;
  margin:0 auto;
  box-shadow:0 8px 18px rgba(0,0,0,.15);
}

h1{text-align:center;margin:5px 0 15px}

/* ===== TOP BAR ===== */
.top-bar{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:10px;
}

/* ===== BUTTON ===== */
button{
  padding:6px 8px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:.8em;
}
.edit-btn{background:#fc6464;color:#fff}
.reset-btn{background:#e63946;color:#fff}
.add-btn{background:#2a9d8f;color:#fff}
.sub-btn{background:#6c757d;color:#fff}
.delete-btn{background:#000;color:#fff}

/* ===== TABLE (‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á) ===== */
table{
  width:100%;
  border-collapse:collapse;
  table-layout:fixed;   /* üîí ‡∏•‡πá‡∏≠‡∏Ñ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏î‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
}

th,td{
  padding:6px 4px;
  text-align:center;
  border-bottom:1px solid #ddd;
  font-size:.8em;
  word-wrap:break-word;
}

th{background:#f1f1f1}

/* ===== EDIT ===== */
.edit-area{
  margin-top:10px;
  display:none;
  gap:5px;
  flex-wrap:wrap;
}

input{
  padding:7px;
  border-radius:6px;
  border:1px solid #ccc;
  flex:1;
}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:20;
}

.modal-content{
  background:#fff;
  padding:20px;
  border-radius:12px;
  max-width:300px;
  width:100%;
  text-align:center;
}

.error{color:red;font-size:.85em}

/* ===== DARK MODE ===== */
body.dark::before{background:rgba(0,0,0,.45)}
body.dark .container,
body.dark .landing{
  background:rgba(20,20,20,.92);
  color:#eee;
}
body.dark th{background:#2a2a2a;color:#fff}
body.dark td{border-bottom:1px solid #444}
body.dark input{
  background:#222;color:#fff;border:1px solid #555;
}

/* ===== MOBILE FIX ===== */
@media (max-width:768px){
  th,td{font-size:.75em}

  /* ‡∏õ‡∏∏‡πà‡∏° + - ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  td button{
    display:block;
    width:100%;
    margin:2px 0;
  }
}
</style>
</head>

<body>

<!-- ===== LANDING ===== -->
<div class="center" id="landingPage">
  <div class="landing">
    <button class="select-btn" id="enterBtn">‡∏à‡∏∏‡∏ï‡∏¥</button>
  </div>
</div>

<!-- ===== MAIN ===== -->
<div class="container" id="mainPage">
  <h1>Jaturathep</h1>

  <div class="top-bar">
    <div id="counter">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å 0 / 30</div>
    <div>
      <button class="edit-btn" id="editModeBtn">Tools</button>
      <button class="reset-btn" id="resetBtn" style="display:none">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </div>
  </div>

  <table>
    <thead id="thead"></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="edit-area" id="editArea">
    <input id="nameInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
    <button class="add-btn" id="addBtn">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
    <button class="add-btn" id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

/* LANDING */
enterBtn.onclick=()=>{
  landingPage.style.display="none";
  mainPage.style.display="block";
};

/* FIREBASE */
const app=initializeApp({
  apiKey:"AIzaSyDsM9ByXHwfxhAG8lBfRKiHSGuxwSiAdls",
  databaseURL:"https://jaturathep-55793-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=getDatabase(app);
const dbRef=ref(db,"jaturathep");

let members=[],editMode=false;
const maxMembers=30;

/* REALTIME */
onValue(dbRef,s=>{
  members=s.val()||[];
  render();
});

function render(){
  tableBody.innerHTML="";
  if(editMode){
    thead.innerHTML=`<tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡πÅ‡∏ó‡πÇ‡∏≠</th><th>‡πÑ‡∏Ñ‡∏•‡πå</th><th>‡∏¢‡∏≠‡∏ô‡∏Æ‡∏µ</th><th>‡∏Ñ‡∏≤‡∏£‡πå‡∏°‡πà‡∏≤</th><th>‡∏•‡∏ö</th></tr>`;
    members.forEach((m,i)=>{
      m.tao??=0;m.kyle??=0;m.yeonhee??=0;m.karma??=0;
      tableBody.innerHTML+=`
      <tr>
        <td>${m.name}</td>
        ${["tao","kyle","yeonhee","karma"].map(k=>`
        <td>
          <button class="sub-btn" onclick="chg(${i},'${k}',-1)">‚àí</button>
          ${m[k]}
          <button class="add-btn" onclick="chg(${i},'${k}',1)">+</button>
        </td>`).join("")}
        <td><button class="delete-btn" onclick="delMember(${i})">‡∏•‡∏ö</button></td>
      </tr>`;
    });
  }else{
    thead.innerHTML=`<tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏ß‡∏°</th></tr>`;
    members.forEach(m=>{
      const sum=(m.tao||0)+(m.kyle||0)+(m.yeonhee||0)+(m.karma||0);
      tableBody.innerHTML+=`<tr><td>${m.name}</td><td>${sum}</td></tr>`;
    });
  }
  counter.innerText=`‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ${members.length} / ${maxMembers}`;
}

window.chg=(i,k,v)=>{
  members[i][k]=Math.max(0,(members[i][k]||0)+v);
  set(dbRef,members);
};
window.delMember=i=>{
  if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠?")){
    members.splice(i,1);
    set(dbRef,members);
  }
};
</script>
</body>
</html>
